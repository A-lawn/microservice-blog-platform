global:
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alerts@blog-platform.com'
  smtp_auth_username: 'alerts@blog-platform.com'
  smtp_auth_password: 'your-email-password'

# å‘Šè­¦è·¯ç”±é…ç½®
route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'default-receiver'
  routes:
    # ä¸¥é‡å‘Šè­¦ç«‹å³å‘é€
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      repeat_interval: 5m
    
    # å®‰å…¨ç›¸å…³å‘Šè­¦
    - match:
        category: security
      receiver: 'security-alerts'
      group_wait: 0s
      repeat_interval: 15m
    
    # ä¸šåŠ¡å‘Šè­¦
    - match:
        category: business
      receiver: 'business-alerts'
      repeat_interval: 30m
    
    # æ€§èƒ½å‘Šè­¦
    - match:
        category: performance
      receiver: 'performance-alerts'
      repeat_interval: 15m

# å‘Šè­¦æ¥æ”¶å™¨é…ç½®
receivers:
  - name: 'default-receiver'
    email_configs:
      - to: 'admin@blog-platform.com'
        subject: '[åšå®¢å¹³å°] {{ .GroupLabels.alertname }} å‘Šè­¦'
        body: |
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦è¯¦æƒ…: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å‘Šè­¦åˆ†ç±»: {{ .Labels.category }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt }}
          {{ end }}

  - name: 'critical-alerts'
    email_configs:
      - to: 'admin@blog-platform.com,ops@blog-platform.com'
        subject: '[ç´§æ€¥] {{ .GroupLabels.alertname }} - åšå®¢å¹³å°ä¸¥é‡å‘Šè­¦'
        body: |
          ğŸš¨ ä¸¥é‡å‘Šè­¦ ğŸš¨
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦è¯¦æƒ…: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å‘Šè­¦åˆ†ç±»: {{ .Labels.category }}
          æœåŠ¡: {{ .Labels.job }}
          å®ä¾‹: {{ .Labels.instance }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt }}
          
          è¯·ç«‹å³å¤„ç†æ­¤å‘Šè­¦ï¼
          {{ end }}
    # é’‰é’‰é€šçŸ¥é…ç½®ï¼ˆå¯é€‰ï¼‰
    webhook_configs:
      - url: 'https://oapi.dingtalk.com/robot/send?access_token=YOUR_DINGTALK_TOKEN'
        send_resolved: true
        http_config:
          proxy_url: ''
        title: '[ç´§æ€¥] åšå®¢å¹³å°ä¸¥é‡å‘Šè­¦'
        text: |
          {{ range .Alerts }}
          **å‘Šè­¦åç§°**: {{ .Annotations.summary }}
          **å‘Šè­¦è¯¦æƒ…**: {{ .Annotations.description }}
          **å‘Šè­¦çº§åˆ«**: {{ .Labels.severity }}
          **æœåŠ¡**: {{ .Labels.job }}
          **å¼€å§‹æ—¶é—´**: {{ .StartsAt }}
          {{ end }}

  - name: 'security-alerts'
    email_configs:
      - to: 'security@blog-platform.com,admin@blog-platform.com'
        subject: '[å®‰å…¨] {{ .GroupLabels.alertname }} - åšå®¢å¹³å°å®‰å…¨å‘Šè­¦'
        body: |
          ğŸ”’ å®‰å…¨å‘Šè­¦ ğŸ”’
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦è¯¦æƒ…: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          æœåŠ¡: {{ .Labels.job }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt }}
          
          è¯·æ£€æŸ¥æ˜¯å¦å­˜åœ¨å®‰å…¨å¨èƒï¼
          {{ end }}

  - name: 'business-alerts'
    email_configs:
      - to: 'business@blog-platform.com,admin@blog-platform.com'
        subject: '[ä¸šåŠ¡] {{ .GroupLabels.alertname }} - åšå®¢å¹³å°ä¸šåŠ¡å‘Šè­¦'
        body: |
          ğŸ“Š ä¸šåŠ¡å‘Šè­¦ ğŸ“Š
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦è¯¦æƒ…: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt }}
          
          è¯·æ£€æŸ¥ä¸šåŠ¡åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼
          {{ end }}

  - name: 'performance-alerts'
    email_configs:
      - to: 'ops@blog-platform.com'
        subject: '[æ€§èƒ½] {{ .GroupLabels.alertname }} - åšå®¢å¹³å°æ€§èƒ½å‘Šè­¦'
        body: |
          âš¡ æ€§èƒ½å‘Šè­¦ âš¡
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦è¯¦æƒ…: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          æœåŠ¡: {{ .Labels.job }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt }}
          
          è¯·æ£€æŸ¥ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ï¼
          {{ end }}

# å‘Šè­¦æŠ‘åˆ¶è§„åˆ™
inhibit_rules:
  # å¦‚æœæœåŠ¡å®Œå…¨ä¸å¯ç”¨ï¼ŒæŠ‘åˆ¶å…¶ä»–ç›¸å…³å‘Šè­¦
  - source_match:
      alertname: ServiceDown
    target_match:
      job: '{{ .Labels.job }}'
    equal: ['job', 'instance']
  
  # å¦‚æœå†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ï¼ŒæŠ‘åˆ¶GCæ—¶é—´å‘Šè­¦
  - source_match:
      alertname: HighMemoryUsage
    target_match:
      alertname: HighGCTime
    equal: ['job', 'instance']